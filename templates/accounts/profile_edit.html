{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - FreelancerHub{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">
                        <i class="fas fa-user-edit me-2"></i>Edit Profile
                    </h2>
                    <p class="text-muted mb-0">Update your personal and professional information.</p>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Basic Information -->
                        <div class="mb-4">
                            <h5 class="mb-3">Basic Information</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="first_name" class="form-label">First Name *</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" 
                                           value="{{ user.first_name }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_name" class="form-label">Last Name *</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" 
                                           value="{{ user.last_name }}" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="bio" class="form-label">Bio</label>
                                <textarea class="form-control" id="bio" name="bio" rows="4" 
                                          placeholder="Tell us about yourself, your experience, and what makes you unique.">{{ profile.bio }}</textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" 
                                           value="{{ profile.phone }}" placeholder="+1 (555) 123-4567">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="location" class="form-label">Location</label>
                                    <input type="text" class="form-control" id="location" name="location" 
                                           value="{{ profile.location }}" placeholder="City, Country">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="website" class="form-label">Website</label>
                                <input type="url" class="form-control" id="website" name="website" 
                                       value="{{ profile.website }}" placeholder="https://yourwebsite.com">
                            </div>
                            
                            <div class="mb-3">
                                <label for="avatar" class="form-label">Profile Picture</label>
                                <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*">
                                {% if profile.avatar %}
                                <div class="mt-2">
                                    <img src="{{ profile.avatar.url }}" alt="Current avatar" class="img-thumbnail" style="max-width: 100px;">
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Freelancer-specific fields -->
                        {% if user.role == 'freelancer' %}
                        <div class="mb-4">
                            <h5 class="mb-3">Freelancer Information</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="hourly_rate" class="form-label">Hourly Rate ($)</label>
                                    <input type="number" class="form-control" id="hourly_rate" name="hourly_rate" 
                                           value="{{ profile.hourly_rate }}" min="0" step="0.01" placeholder="25.00">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="experience_years" class="form-label">Years of Experience</label>
                                    <input type="number" class="form-control" id="experience_years" name="experience_years" 
                                           value="{{ profile.experience_years }}" min="0" max="50" placeholder="3">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="skills" class="form-label">Skills</label>
                                <input type="text" class="form-control" id="skills" name="skills" 
                                       value="{{ profile.skills }}" 
                                       placeholder="e.g., Python, Django, React, UI/UX Design, WordPress">
                                <div class="form-text">Separate multiple skills with commas.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="portfolio_url" class="form-label">Portfolio URL</label>
                                <input type="url" class="form-control" id="portfolio_url" name="portfolio_url" 
                                       value="{{ profile.portfolio_url }}" placeholder="https://yourportfolio.com">
                            </div>
                        </div>
                        {% endif %}

                        <!-- Employer-specific fields -->
                        {% if user.role == 'employer' %}
                        <div class="mb-4">
                            <h5 class="mb-3">Company Information</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="company_name" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="company_name" name="company_name" 
                                           value="{{ profile.company_name }}" placeholder="Your Company Inc.">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="company_size" class="form-label">Company Size</label>
                                    <select class="form-select" id="company_size" name="company_size">
                                        <option value="">Select size</option>
                                        <option value="1-10" {% if profile.company_size == '1-10' %}selected{% endif %}>1-10 employees</option>
                                        <option value="11-50" {% if profile.company_size == '11-50' %}selected{% endif %}>11-50 employees</option>
                                        <option value="51-200" {% if profile.company_size == '51-200' %}selected{% endif %}>51-200 employees</option>
                                        <option value="201-500" {% if profile.company_size == '201-500' %}selected{% endif %}>201-500 employees</option>
                                        <option value="500+" {% if profile.company_size == '500+' %}selected{% endif %}>500+ employees</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Submit Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'accounts:profile' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Character counter for bio
    const bioTextarea = document.getElementById('bio');
    const maxLength = 500;
    
    bioTextarea.addEventListener('input', function() {
        const remaining = maxLength - this.value.length;
        let counter = document.getElementById('bio-counter');
        
        if (!counter) {
            counter = document.createElement('div');
            counter.id = 'bio-counter';
            counter.className = 'form-text';
            this.parentNode.appendChild(counter);
        }
        
        counter.textContent = `${this.value.length}/${maxLength} characters`;
        
        if (remaining < 50) {
            counter.className = 'form-text text-warning';
        } else {
            counter.className = 'form-text';
        }
    });
    
    // Skills input enhancement
    const skillsInput = document.getElementById('skills');
    if (skillsInput) {
        skillsInput.addEventListener('input', function() {
            const skills = this.value.split(',').map(skill => skill.trim()).filter(skill => skill);
            const uniqueSkills = [...new Set(skills)];
            this.value = uniqueSkills.join(', ');
        });
    }
    
    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const bio = document.getElementById('bio').value.trim();
        const skills = document.getElementById('skills');
        
        if (bio.length > maxLength) {
            e.preventDefault();
            alert('Bio is too long. Please keep it under 500 characters.');
            return;
        }
        
        if (skills && skills.value) {
            const skillsList = skills.value.split(',').map(skill => skill.trim()).filter(skill => skill);
            if (skillsList.length > 20) {
                e.preventDefault();
                alert('Please limit to 20 skills or fewer.');
                return;
            }
        }
    });
});
</script>
{% endblock %}
